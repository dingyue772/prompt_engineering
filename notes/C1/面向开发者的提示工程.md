# readme部分
**Prompt**：给大模型的输入
**Completion**：大模型返回的输出
**prompt engineering**：针对特定任务构造能充分发挥大模型能力的 Prompt 的技巧，以实现包括**总结、推断、转换**等功能
**主要内容：**
书写 Prompt 的原则与技巧；
文本总结（如总结用户评论）；
文本推断（如情感分类、主题提取）；
文本转换（如翻译、自动纠错）；
扩展（如书写邮件）
ps：使用的openai 的api进行具体实现
# 简介
>LLM的更强大功能是能通过 API 接口调用，从而快速构建软件应用程序
# 提示原则和技巧
## prompt原则
1. **编写清晰、具体的指令**：准确描述需求、提供充足上下文
2. **给予模型充足思考时间**：逐步推理
## prompt设计技巧
**分隔符的使用**
使用分隔符清晰地表示输入的不同部分，防止提示词注入（Prompt Rejection）。提示词注入即user input可能与预设的prompt冲突，从而操纵llm，导致llm产生乱七八糟的output
例如用引号分隔待处理文本

**寻求结构化的输出**
在指令中包含要求llm按照某种格式组织内容，例如JSON、HTML等，这种输出非常适合在代码中进一步解析和处理。
示例如下：要求gpt返回包含书籍标题、书籍作者和书籍类别的json数据
```txt
prompt = f"""
请生成包括书名、作者和类别的三本虚构的、非真实存在的中文书籍清单，\
并以 JSON 格式提供，其中包含以下键:book_id、title、author、genre。
"""
```

**要求模型检查是否满足条件**
判断任务数据是否满足预设的假设，进行对应的条件处理
例如：要求gpt根据文本是否含有步骤性数据进行对应处理，编写指令or给出提示


**提供少量示例** 
即 "few-shot prompting"
在模型执行任务之前，给模型一两个已完成的样例，让模型了解我们的要求和期望的输出样式，即达到“预热”模型的目的
例如：让gpt根据耐心的比喻，说明韧性

**指定完成任务的步骤**
通过将任务拆分，让llm一次完成一个小的任务，多次累积起来完成一个复杂任务

# 迭代优化
示例：根据产品说明书生成产品营销描述稿

```txt
# Prompt ：基于说明书创建营销描述 
# 迭代1：限制生成文本长度
# 迭代2：指定生成文本受众——家具零售商；在描述末尾附上产品ID
# 迭代3：添加展示产品尺寸信息的表格，并指定生成文本为html格式


prompt = f"""
您的任务是帮助营销团队基于技术说明书创建一个产品的营销描述。

根据```标记的技术说明书中提供的信息，编写一个产品描述。

该描述面向家具零售商，因此应具有技术性质，并侧重于产品的材料构造。

在描述末尾，包括技术规格中每个7个字符的产品ID。

在描述之后，包括一个表格，提供产品的尺寸。表格应该有两列。第一列包括尺寸的名称。第二列只包括英寸的测量值。给表格命名为“产品尺寸”。将所有内容格式化为可用于网站的HTML格式。将描述放在<div>元素中。

使用最多50个词。

技术说明: ```{fact_sheet_chair}```
"""
```
# 文本概括
示例：概括电商评论
```txt
# 迭代1——限制字数
# 迭代2——增强prompt 给出某一特定视角的偏好

prompt = f"""
您的任务是从电子商务网站上生成一个产品评论的简短摘要。

请对三个反引号之间的评论文本进行概括，最多30个字。

并且侧重在快递服务上。

评论: ```{prod_review}```
"""

# 迭代3——关键信息提取
prompt = f"""
您的任务是从电子商务网站上的产品评论中提取相关信息。

请从以下三个反引号之间的评论文本中提取产品运输相关的信息，最多30个词汇。

评论: ```{prod_review}```
"""
response = get_completion(prompt)
print(response)
```
# 推断
## 情感推断
示例1：情感二分类

```txt
# 迭代1——解析评论的情感倾向
# 迭代2——规范情感倾向的输出
prompt = f"""
以下用三个反引号分隔的产品评论的情感是什么？

用一个单词回答：「正面」或「负面」。

评论文本: ```{lamp_review}```
"""
```

示例2：识别出多种情感类型

```txt
prompt = f"""
识别以下评论的作者表达的情感。包含不超过五个项目。将答案格式化为以逗号分隔的单词列表。

评论文本: ```{lamp_review}```
"""
```

## 信息提取
示例1：从评论中提取商品信息

```txt
prompt = f"""
从评论文本中识别以下项目：
- 评论者购买的物品
- 制造该物品的公司

评论文本用三个反引号分隔。将你的响应格式化为以 “物品” 和 “品牌” 为键的 JSON 对象。
如果信息不存在，请使用 “未知” 作为值。
让你的回应尽可能简短。

评论文本: ```{lamp_review}```
"""
```

示例2：综合情感推断和信息提取

```txt
prompt = f"""
从评论文本中识别以下项目：
- 情绪（正面或负面）
- 审稿人是否表达了愤怒？（是或否）
- 评论者购买的物品
- 制造该物品的公司

评论用三个反引号分隔。将你的响应格式化为 JSON 对象，以 “情感倾向”、“是否生气”、“物品类型” 和 “品牌” 作为键。
如果信息不存在，请使用 “未知” 作为值。
让你的回应尽可能简短。
将 “是否生气” 值格式化为布尔值。

评论文本: ```{lamp_review}```
"""
```

## 主题推断
示例1：推断讨论主题

```txt
prompt = f"""
确定以下给定文本中讨论的五个主题。

每个主题用1-2个词概括。

请输出一个可解析的Python列表，每个元素是一个字符串，展示了一个主题。

给定文本: ```{story}```
"""
```

示例2：判断特定主题是否为指定文本中的话题（可以利用结果判断是否将该文本推送给关注特定主题的平台用户）

```txt
prompt = f"""
判断主题列表中的每一项是否是给定文本中的一个话题，

以列表的形式给出答案，每个元素是一个Json对象，键为对应主题，值为对应的 0 或 1。

主题列表：美国航空航天局、当地政府、工程、员工满意度、联邦政府

给定文本: ```{story}```
"""
```
# 6. 文本转换
## 文本翻译
**直接翻译**
```txt
prompt = f"""
将以下中文翻译成西班牙语: \ 
```您好，我想订购一个搅拌机。```
"""
```
**识别语种**
```txt
prompt = f"""
请告诉我以下文本是什么语种: 
```Combien coûte le lampadaire?```
"""
```
**多语种翻译**
```txt
prompt = f"""
请将以下文本分别翻译成中文、英文、法语和西班牙语: 
```I want to order a basketball.```
"""
```
**翻译+语气转换指定**
```txt
prompt = f"""
请将以下文本翻译成中文，分别展示成正式与非正式两种语气: 
```Would you like to order a pillow?```
"""
```
**通用翻译器**
```txt
prompt = f"告诉我以下文本是什么语种，直接输出语种，如法语，无需输出标点符号: ```{issue}```"
lang = get_completion(prompt)
print(f"原始消息 ({lang}): {issue}\n")

prompt = f"""
将以下消息分别翻译成英文和中文，并写成
中文翻译：xxx
英文翻译：yyy
的格式：
```{issue}```
"""
response = get_completion(prompt)
print(response, "\n=========================================")
```

## 语气与写作风格调整
示例：口语转换为正式用语
```txt
prompt = f"""
将以下文本翻译成商务信函的格式: 
```小老弟，我小羊，上回你说咱部门要采购的显示器是多少寸来着？```
"""
```

## 文件格式转换
示例：将json数据用html表格展示
```json
data_json = { "resturant employees" :[ 
    {"name":"Shyam", "email":"shyamjaiswal@gmail.com"},
    {"name":"Bob", "email":"bob32@gmail.com"},
    {"name":"Jai", "email":"jai87@gmail.com"}
]}
```
```txt
prompt = f"""
将以下Python字典从JSON转换为HTML表格，保留表格标题和列名：{data_json}
"""
```
```python
from IPython.display import display, Markdown, Latex, HTML, JSON
display(HTML(response))
```

## 拼写及语法纠正
示例：句子校正
```txt
prompt = f"""请校对并更正以下文本，注意纠正文本保持原始语种，无需输出原始文本。
    如果您没有发现任何错误，请说“未发现错误”。
    
    例如：
    输入：I are happy.
    输出：I am happy.
    ```{text[i]}```"""
```
```python
prompt = f"校对并更正以下商品评论：```{text}```"
response = get_completion(prompt)
from redlines import Redlines
from IPython.display import display, Markdown

diff = Redlines(text,response)
display(Markdown(diff.output_markdown))
```

综合示例：语法纠正、翻译、语气调整、格式转换
```txt
prompt = f"""
针对以下三个反引号之间的英文评论文本，
首先进行拼写及语法纠错，
然后将其转化成中文，
再将其转化成优质淘宝评论的风格，从各种角度出发，分别说明产品的优点与缺点，并进行总结。
润色一下描述，使评论更具有吸引力。
输出结果格式为：
【优点】xxx
【缺点】xxx
【总结】xxx
注意，只需填写xxx部分，并分段输出。
将结果输出成Markdown格式。
```{text}```
"""
```
# 7. 文本扩展
**示例：定制客户邮件**
要求：根据客户的评价和其中的情感倾向，使用大语言模型针对性地生成回复邮件
```txt
prompt = f"""
你是一位客户服务的AI助手。
你的任务是给一位重要客户发送邮件回复。
根据客户通过“```”分隔的评价，生成回复以感谢客户的评价。提醒模型使用评价中的具体细节
用简明而专业的语气写信。
作为“AI客户代理”签署电子邮件。
客户评论：
```{review}```
评论情感：{sentiment}
"""
```

**引入温度系数**
llm的“温度”(temperature) 参数可以控制生成文本的随机性和多样性，temp值越大，llm输出的多样性越大

# 聊天机器人
## 给定身份
**system message**：设置助手的行为和角色，并作为对话的高级指示
举个例子
```txt
messages =  [  
{'role':'system', 'content':'你是个友好的聊天机器人。'},    
{'role':'user', 'content':'Hi, 我是Isa。'}  ]
response = get_completion_from_messages(messages, temperature=1)
print(response)
```
## 构建一个订餐机器人
设计：这个机器人将被设计为自动收集用户信息，并接收来自比萨饼店的订单
使用panel库中的UI显示订单机器人，获取用户输入，根据用户输入和llm的回答来构建对话内容messages
